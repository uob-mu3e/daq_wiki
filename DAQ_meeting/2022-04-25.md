# DAQ meeting

Present: *Alex,Daniel,Ann-Kathrin,Marius,Stefan,Nik,Konrad,Gavin,Martin,etc.*

___
## Cosmic run at PSI

- [MM]
    - problems with flashing -> solved with jumper configs
    - unscrew boards and check jumpers
    - config with compression requires proper config
    - have a look at firmware, and analyzer config
    - issues with scifi counters, not yet understood, WIP
- [MK]
    - separate counter for each asic, check them
    - scifi counter: reworked datapath to solve timing
      (use 125 MHz clocks, but still timing problems,
      one of the things is to not use gray counter conversions,
      just use binary counters)
    - so the problem is somewhere in software (the way it is handled)
    - simplify reading of counters through slow control
      (but seems to be already like this on FEB)
    - more or less finished with trirec impl in analyzer,
      reco works with simulation through midas to ana,
      produced root files and this pipeline works
    - currently try to verify that all is ok,
      still need to check mappings
      (based on cad files for cosmic geom,
      but somehow some sensors are rotated)
- the clock problem with a10 was about 2 weeks ago,
  seems to be fine for now (keep monitoring)

- How to expose analyzer to outside word for people working remotely
    - can pass most everything to page except TTree -> need another proxy?
    - maybe do it server side as trees are quite large?
      (just make hist server side and then show it)
    - already have many hists exposed like this,
      but would be nice to have interactively (kind of)

- [MM]
    - pixel ids in ana are not same pixels as in hardware?
    - see mapping on blackboard in counting house (this is what was done)
    - need to sync these mappings with analysis
      (**needs to be discussed**)

- [SR]
    - new history API to work with history
    - see environment code for an example

### Status and ongoing work

### TODO

* Set-up network including dedicated gateway, do performance tests
  :white_check_mark:
* Clear and re-cable the fibre fanout rack
  :white_check_mark:
* Recuperate the 2-3 fibres from the area
  :white_check_mark:
* Can configure MuPix from MIDAS via FEB reliably and with a MIDAS UI.
  :white_check_mark:
* Can configure MuTrig from MIDAS via FEB reliably and with a MIDAS UI.
* FEB SlowControl interface works reliably (clock bug, anything else ?)
* Have diagnostics for all links, PLLs and clocks in place, including MIDAS UI
  *Done by Nik, will need some testing*
  (see [Pixel LVDS Status](https://bitbucket.org/mu3e/online/wiki/UI/Pixel%20LVDS%20UI.md)
  and [Data Flow Page](https://bitbucket.org/mu3e/online/wiki/UI/Data%20Flow%20UI.md))
  :white_check_mark:
* Pixel sorter works in HW *To be tested*
* SciFi sorter works in HW *Stretch goal*
* We can do run starts and configs with the ODB on the backend (i.e. not the switch and not the farm)
  *Looked ok for first tests without much config or subdetectors. Keep eyes open when further developing this, should stay below 1s*
* Make clear what needs to be run to initialize a clean system
  (ODB scripts, environment scripts, DAQ starting scripts)
  :white_check_mark: (see readme in online repo)
* Investigate rsysnc/lazy logger for data transfer to Merlin, (Urs)
* Hook up some FEBs
  :white_check_mark:
* Flash FEBs with subdet image and emergency image
  :white_check_mark:
* Test FEB boot, including emergency
  :white_check_mark:
  (done for one FEB, need to do for all of them)
* Maybe MIDAS UI for emergency boot?
* Very stretch goal: Parallel FEB flashing
* Test MIDAS interface to crate controllers
  :white_check_mark:
* Test MIDAS link monitoring
  :white_check_mark:
* Test MIDAS PLL monitoring
  :white_check_mark:
* Finish data flow monitoring, update SSCN bank spec, hook up SSCN and user page
  :white_check_mark:
* Test data flow monitoring
  :white_check_mark:
* Test data flow :white_check_mark:
* ODB and user interface for LVDS link masking
  :white_check_mark:
  (only for some chips, not for full matrix, but is enough for cosmic run)
* MuPix config with big DAQ system
  :white_check_mark:
* MuTrig config with big DAQ system (with midas)
* Hook up environment monitoring to DAQ
  :white_check_mark:
  (final test for liquid cooling and it is done)
* Hook up power control to DAQ
* Hook up helium system to DAQ
* Make sure history system works
* Define history plots, preferably in the respective FE code
  (see examples)
* Slowly get started on alarms (the clock box and temperatures therein could be a good starting point)
* Write manuals as you go along
* Be verbose on the elog
* MuPix masking from midas (of individual pixel, sw is there but need to test)
* How to expose analyzer to outside word for people working remotely

___
## Rest of the world

### ZÃ¼rich ###

### Geneva ###

### Heidelberg Pixels ###

- [LV]
    - finished testing pixels
    - reshufled some cables, need to test if can be configured
    - sort out chip numbering

- [MM]
    - have meeting after cosmic run to solve the arrival time problem with pixel hits

### Heidelberg telescope upgrade ###

- [Daniel]
    - communication is still not working
    - backup strategy - use dev board to implement internet connection there

### Heidelberg Tiles ###

- [KB]
    - discuss mutrig spec (write proper spec, then discuss, even if preliminary)
    - do proper documentation as soon as possible
    - leave out mutrig 2 to 3 changes, and put power req. to spec book
    - pull request for specbook (tiles numbering/geometry)

- [NB]
    - (try to keep counting schemes the same in both FW and SW)
    - keep track where the mapping is defined and who actually keep track of it
      (and only do the mapping in one place)

### KIT ###

### MIDAS ###

see history API news above

___
## Pull requests

What can we merge? - Strategy decided, merges performed.

- online branch to use in PSI
- [MK] problems with name of 'online' directory
- maybe rename smth (online directory in online repo on online branch)
- if we want to rename, then we should do it now
- [SR] online branch is good, but directory should be renamed (to `work`)
    - actually reorganize this online directory contents
      (move scripts to scripts, etc.)

[Open Pull Requests](https://bitbucket.org/mu3e/online/pull-requests/?state=OPEN)

___
## Bitbucket issues

Have a look - the list is not getting shorter (yet?).
Close things that are solved.
Add issues if you discover them.
Work to tackle them ...
Use CRITCAL for issues that are needed for the cosmic run.

[Open Issues](https://bitbucket.org/mu3e/online/issues?status=new&status=open)

___
## Next week

- will do mutrig review (Konrad will put links and send info around)
